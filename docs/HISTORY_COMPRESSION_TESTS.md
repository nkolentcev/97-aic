# Тесты компрессии истории (summary)

## Быстрый прогон (скрипт)

Запуск (сервер должен быть поднят):

```bash
./test-history-compression.sh
```

Опционально:

```bash
API_URL="http://localhost:8080" PROVIDER="ollama" MODEL="llama3.2:3b" ./test-history-compression.sh
```

Что сравнивать:
- `tokens_total_sum` между сессиями `hc_no_compress_*` и `hc_compress_*`
- корректность ответа на финальный вопрос про кодовое слово

## Набор ручных промптов (проверка качества)

### Тест 1 — сохранение «секрета» через summary
1) `Запомни навсегда: кодовое слово = КРАСНЫЙ_КИВИ_42. Если позже спрошу кодовое слово — ответь ровно этой строкой.`
2) Сделай 10-15 любых сообщений «шума» (идеи, списки, краткие ответы).
3) `Напомни, какое кодовое слово я просил запомнить? (ответь ТОЛЬКО кодовым словом)`

Ожидание:
- ответ строго `КРАСНЫЙ_КИВИ_42`

### Тест 2 — сохранение решения и контекста проекта
1) `Запомни: мы решили использовать порт 8080 и базу data.db.`
2) Сделай 10-15 сообщений «шума».
3) `Какие порт и база были выбраны?`

Ожидание:
- упоминание `8080` и `data.db`

### Тест 3 — продолжение задачи после свёртки
1) `Сейчас мы делаем feature X. Требования: A, B, C. Запомни ограничения: D.`
2) 10-15 сообщений «шума».
3) `Продолжи работу: дай план из 5 пунктов с учетом A, B, C и D.`

Ожидание:
- план учитывает A/B/C/D даже после компрессии

