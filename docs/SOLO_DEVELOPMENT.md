# Современный подход к соло-разработке с агентской схемой

Документ описывает современный workflow для организации соло-разработки с использованием Claude Code и Cursor в рамках агентской архитектуры.

## Обзор подхода

Соло-разработка с агентской схемой превращает одинокого разработчика в координатора команды специализированных ИИ-агентов, каждый из которых отвечает за свою область экспертизы.

## Инструменты

- **Cursor** - IDE с интеграцией Claude Code
- **Claude Code** - ИИ-ассистент для разработки
- **Git** - контроль версий
- **Gitea/GitHub Actions** - CI/CD
- **Документация как код** - Markdown в репозитории

## Цикл разработки

### 1. Планирование

#### Использование агентов для планирования

```
<agent_go>
Проанализируй требования: [описание задачи]
Предложи архитектуру решения.
Определи необходимые компоненты.
</agent_go>

<agent_svelte>
Определи UI/UX требования для: [описание функции]
Предложи структуру компонентов.
</agent_svelte>

<agent_devops>
Оцени влияние на инфраструктуру.
Определи необходимые изменения в CI/CD.
</agent_devops>
```

#### Практики планирования

1. **Создание issue/задачи**
   - Описание в Markdown
   - Четкие критерии приемки
   - Теги для категоризации

2. **Разбиение на подзадачи**
   - Использование тегов агентов
   - Определение зависимостей
   - Оценка сложности

3. **Создание плана в документации**
   - Файл `PLAN.md` или секция в issue
   - Структурированный список задач
   - Ссылки на связанные компоненты

#### Пример структуры планирования

```markdown
# План реализации: История сообщений

## Задачи

### Backend (`<agent_go>`)
- [ ] Создать endpoint `/api/history`
- [ ] Реализовать in-memory хранилище
- [ ] Добавить валидацию запросов

### Frontend (`<agent_svelte>`)
- [ ] Создать компонент `HistoryPanel.svelte`
- [ ] Интегрировать с API
- [ ] Добавить фильтрацию

### DevOps (`<agent_devops>`)
- [ ] Обновить документацию API.md
- [ ] Добавить тесты в CI/CD
```

### 2. Разработка

#### Workflow с Cursor и Claude Code

**Шаг 1: Создание feature ветки**
```bash
git checkout -b feature/history-messages
```

**Шаг 2: Работа с агентами через Cursor**

В Cursor используйте:
- **Cmd/Ctrl + K** - для быстрых запросов к Claude
- **Cmd/Ctrl + L** - для чата с контекстом файла
- **@agent_go**, **@agent_svelte** - для обращения к конкретным агентам

**Пример запроса:**
```
@agent_go Создай endpoint /api/history который возвращает последние 50 сообщений.
Используй существующую структуру из api/chat.go.
Добавь валидацию параметров запроса.
```

**Шаг 3: Итеративная разработка**

1. **Создание базовой структуры**
   - Агент создает каркас кода
   - Разработчик проверяет структуру

2. **Добавление функциональности**
   - Пошаговые запросы к агенту
   - Проверка каждого шага

3. **Рефакторинг**
   - Запрос на улучшение кода
   - Оптимизация производительности

#### Практики разработки

**Использование контекста:**
- Открывайте связанные файлы в Cursor
- Используйте `@filename` для ссылки на конкретные файлы
- Группируйте связанные изменения

**Инкрементальные коммиты:**
```bash
git add backend/api/history.go
git commit -m "feat: добавить endpoint /api/history"
```

**Проверка на каждом шаге:**
- Компиляция/линтинг
- Быстрые тесты
- Проверка логики

### 3. Тестирование

#### Автоматизированное тестирование

**Backend тесты (`<agent_go>`)**

```go
// Пример запроса к агенту:
// @agent_go Создай unit тесты для api/history.go
// Покрой основные сценарии: успешный запрос, пустая история, ошибки
```

**Frontend тесты (`<agent_svelte>`)**

```typescript
// @agent_svelte Создай компонентные тесты для HistoryPanel.svelte
// Проверь рендеринг, взаимодействие, интеграцию с API
```

#### Ручное тестирование

1. **Локальное тестирование**
   ```bash
   # Backend
   cd backend && go test ./...
   
   # Frontend
   cd frontend && npm run test
   ```

2. **Интеграционное тестирование**
   - Запуск полного стека локально
   - Проверка end-to-end сценариев
   - Тестирование через браузер

3. **Использование агентов для тестирования**
   ```
   @agent_go Протестируй endpoint /api/history:
   - С пустой историей
   - С 100 сообщениями
   - С невалидными параметрами
   ```

#### CI/CD тестирование

Автоматические тесты в пайплайне:
- Линтинг кода
- Unit тесты
- Сборка проекта
- Проверка типов (TypeScript)

### 4. Код ревью

#### Self-review с использованием агентов

**Шаг 1: Автоматическая проверка**

```bash
# Линтинг
go fmt ./...
golangci-lint run

# TypeScript
npm run check
```

**Шаг 2: Ревью через агентов**

```
@agent_go Проверь код в api/history.go:
- Соответствие стилю проекта
- Обработка ошибок
- Безопасность
- Производительность

Предложи улучшения.
```

**Шаг 3: Проверка архитектуры**

```
@agent_go Проверь интеграцию нового endpoint с существующей архитектурой.
Убедись в совместимости с другими компонентами.
```

**Шаг 4: Документация**

```
@agent_devops Обнови документацию:
- API.md с новым endpoint
- ARCHITECTURE.md если изменилась архитектура
```

#### Чеклист для self-review

- [ ] Код компилируется без ошибок
- [ ] Все тесты проходят
- [ ] Соответствие стилю кода проекта
- [ ] Обработка всех ошибок
- [ ] Нет утечек памяти/ресурсов
- [ ] Документация обновлена
- [ ] Нет хардкода секретов
- [ ] Логирование добавлено где нужно

### 5. Деплой

#### Автоматический деплой через CI/CD

**Настройка пайплайна (`<agent_devops>`)**

```yaml
# .gitea/workflows/deploy.yml
# Автоматически деплоится при merge в main
```

**Процесс деплоя:**

1. **Автоматический (через CI/CD)**
   - Push в `main` → автоматический деплой
   - Тесты → сборка → деплой
   - Уведомления об успехе/ошибке

2. **Ручной деплой**
   ```bash
   ./deploy/deploy.sh
   ```

#### Staging окружение

**Рекомендуемая схема:**
- `main` → production (автоматически)
- `develop` → staging (автоматически)
- Feature ветки → локальная разработка

**Использование агентов для деплоя:**

```
@agent_devops Настрой деплой feature/history-messages на staging.
Добавь healthcheck для нового endpoint.
```

#### Откат изменений

```bash
# Быстрый откат через Git
git revert <commit-hash>
git push

# Или через CI/CD
# Откат последнего деплоя через интерфейс Gitea
```

### 6. Мониторинг

#### Логирование

**Структурированное логирование (`<agent_go>`)**

```go
// Запрос к агенту:
// @agent_go Добавь структурированное логирование в api/history.go
// Логируй: запросы, ошибки, время выполнения
```

**Уровни логирования:**
- `DEBUG` - детальная информация для разработки
- `INFO` - общая информация о работе
- `WARN` - предупреждения
- `ERROR` - ошибки

#### Метрики

**Сбор метрик (`<agent_devops>`)**

```
@agent_devops Настрой сбор метрик:
- Количество запросов к /api/history
- Время ответа
- Количество ошибок
```

**Полезные метрики:**
- Response time
- Error rate
- Request rate
- Resource usage (CPU, memory)

#### Health checks

**Endpoint для проверки здоровья (`<agent_go>`)**

```go
// GET /health
// Проверяет:
// - Доступность БД (если есть)
// - Доступность GigaChat API
// - Состояние сервиса
```

#### Алерты

**Настройка уведомлений (`<agent_devops>`)**

- Ошибки в логах
- Превышение порогов метрик
- Недоступность сервиса

## Интеграция с Cursor

### Настройка рабочего пространства

1. **Открытие проекта в Cursor**
   ```bash
   cursor /path/to/project
   ```

2. **Настройка контекста**
   - `.cursorrules` - правила для агентов
   - `.cursor/` - конфигурация Cursor

3. **Использование файлов контекста**
   - `@docs/ARCHITECTURE.md` - для понимания архитектуры
   - `@CLAUDE.md` - для правил проекта
   - `@ai-template.md` - для понимания агентов

### Эффективные паттерны работы

#### Паттерн 1: Итеративная разработка

```
1. Запрос к агенту: "Создай базовую структуру"
2. Проверка результата
3. Запрос: "Добавь валидацию"
4. Проверка
5. Запрос: "Добавь обработку ошибок"
```

#### Паттерн 2: Рефакторинг с контекстом

```
@agent_go Рефактори api/chat.go используя паттерны из api/history.go
Улучши обработку ошибок и логирование.
```

#### Паттерн 3: Кросс-агентная координация

```
@agent_go Создай endpoint /api/history
@agent_svelte Создай компонент для отображения истории
@agent_devops Обнови документацию
```

## Автоматизация

### Pre-commit hooks

```bash
# .git/hooks/pre-commit
#!/bin/bash
go fmt ./...
go test ./...
npm run check
```

### GitHub Actions / Gitea Actions

Автоматизация:
- Тесты на каждый PR
- Линтинг кода
- Сборка проекта
- Деплой при merge

### Скрипты для разработки

```bash
# backend/run-dev.sh - запуск с настройками для разработки
# frontend/dev.sh - запуск frontend с hot-reload
# scripts/test-all.sh - запуск всех тестов
```

## Best Practices

### 1. Документирование решений

При принятии архитектурных решений:
- Создайте `docs/DECISIONS.md`
- Задокументируйте альтернативы
- Объясните выбор

### 2. Версионирование API

При изменении API:
- Версионирование endpoints
- Обратная совместимость
- Deprecation warnings

### 3. Безопасность

- Не коммитить секреты
- Использовать переменные окружения
- Регулярно обновлять зависимости
- Проверка безопасности через агентов

### 4. Производительность

- Профилирование кода
- Оптимизация критических путей
- Кэширование где возможно

## Метрики успеха

### Для процесса разработки

- Время от идеи до деплоя
- Количество багов в production
- Покрытие тестами
- Качество кода (линтинг)

### Для использования агентов

- Эффективность запросов к агентам
- Качество генерируемого кода
- Время на рефакторинг

## Заключение

Соло-разработка с агентской схемой позволяет:

1. **Масштабировать экспертизу** - использовать специализированных агентов
2. **Ускорить разработку** - параллельная работа над разными компонентами
3. **Улучшить качество** - автоматизированное тестирование и ревью
4. **Упростить деплой** - автоматизация через CI/CD
5. **Обеспечить мониторинг** - структурированное логирование и метрики

Ключ к успеху - правильная координация агентов и итеративный подход к разработке.

